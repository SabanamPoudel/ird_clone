<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tax Payer Verification</title>
    <link rel="stylesheet" href="../../extjs/resources/ext-all.css">
    <link rel="stylesheet" href="../../css/all.css">
    <style>
        body {
            background: #DFE9F6;
            margin: 0;
            font-family: tahoma, arial, verdana, sans-serif;
            font-size: 11px;
        }
        .breadcrumb {
            background: #DFE9F6;
            padding: 8px 12px;
            font-size: 11px;
            color: #15498B;
        }
        .main-container {
            background: #DFE9F6;
            padding: 10px;
        }
        .page-title {
            background: linear-gradient(to bottom, #D0E1F5 0%, #BAD4F0 100%);
            border: 1px solid #99BCE8;
            border-bottom: 1px solid #5B91D3;
            padding: 6px 12px;
            font-weight: bold;
            font-size: 11px;
            color: #15498B;
            margin-bottom: 10px;
        }
        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 2px 8px;
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E8E8 100%);
            border: 1px solid #99BCE8;
            cursor: pointer;
            font-size: 11px;
            color: #15498B;
            text-decoration: none;
        }
        .back-button:before {
            content: 'â—„';
            font-size: 10px;
        }
        .content-wrapper {
            display: flex;
            gap: 10px;
        }
        .panel {
            background: #DFE9F6;
            border: 1px solid #99BCE8;
            flex: 1;
        }
        .panel-header {
            background: linear-gradient(to bottom, #D0E1F5 0%, #BAD4F0 100%);
            border-bottom: 1px solid #99BCE8;
            padding: 6px 12px;
            font-weight: bold;
            font-size: 11px;
            color: #15498B;
        }
        .panel-body {
            padding: 15px;
            background: #DFE9F6;
        }
        .form-row {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        .form-label {
            width: 110px;
            font-size: 11px;
            color: #000;
        }
        .form-input, .form-select {
            padding: 3px 5px;
            font-size: 11px;
            border: 1px solid #B5B8C8;
            background: #FFFFFF;
            font-family: tahoma, arial, verdana, sans-serif;
        }
        .form-select {
            width: 200px;
        }
        .form-input {
            width: 190px;
        }
        .btn {
            padding: 3px 10px;
            font-size: 11px;
            border: 1px solid #99BCE8;
            background: linear-gradient(to bottom, #FFFFFF 0%, #E8E8E8 100%);
            cursor: pointer;
            margin-right: 5px;
            color: #15498B;
            font-weight: bold;
            font-family: tahoma, arial, verdana, sans-serif;
        }
        .btn:disabled {
            background: #F0F0F0;
            color: #999;
            border-color: #CCC;
            cursor: not-allowed;
        }
        .btn:hover:not(:disabled) {
            background: linear-gradient(to bottom, #F5F5F5 0%, #D8D8D8 100%);
        }
        .search-panel {
            min-width: 300px;
            max-width: 400px;
        }
        .status-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="page-title">
            <button class="back-button" onclick="parent.closeVerificationModal()">Back</button>
            Tax Payer Verification
        </div>
        
        <div class="content-wrapper">
            <!-- Left Panel: Tax Payer Verification -->
            <div class="panel">
                <div class="panel-header">Tax Payer Verification</div>
                <div class="panel-body">
                    <div class="form-row">
                        <label class="form-label">Module:</label>
                        <select class="form-select" id="moduleSelect">
                            <option value="">---SELECT---</option>
                            <option>Vat Return Entry</option>
                            <option>Estimated Return Entry</option>
                            <option>D-02 Return Entry</option>
                            <option>D-03 Return Entry</option>
                            <option>Electronic Billing</option>
                            <option>TDS</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <label class="form-label">Submission No.:</label>
                        <input class="form-input" type="text" id="submissionNoInput">
                    </div>
                    
                    <div class="form-row">
                        <label class="form-label"></label>
                        <div>
                            <button class="btn" type="button" id="previewBtn" disabled>Preview</button>
                            <button class="btn" type="button" id="verifyBtn" disabled>Verify</button>
                            <button class="btn" type="button" id="resetBtn">Reset</button>
                            <button class="btn" type="button">Proceed To Payment</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Panel: Search Submission Number -->
            <div class="panel search-panel">
                <div class="panel-header">Search Submission Number</div>
                <div class="panel-body">
                    <div class="form-row">
                        <label class="form-label">Status:</label>
                        <div class="status-row">
                            <select class="form-select" style="width: 120px;">
                                <option>All</option>
                                <option>Verified</option>
                                <option>Submitted</option>
                                <option>Not Submitted</option>
                            </select>
                            <button class="btn" type="button">List</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal for E-Return Verified -->
    <div id="verifySuccessModal" style="display:none;position:fixed;z-index:9999;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);">
        <div style="position:absolute;top:80px;left:50%;transform:translateX(-50%);background:#eaf1fa;border-radius:8px;min-width:320px;max-width:90vw;box-shadow:0 2px 16px rgba(0,0,0,0.2);border:1.5px solid #b5cbe7;padding:0;">
            <div style="padding:10px 18px 0 18px;font-size:16px;font-weight:bold;color:#1a4b8c;letter-spacing:0.5px;">INFO
                <span onclick="hideVerifySuccessModal()" style="position:absolute;top:8px;right:14px;font-size:18px;cursor:pointer;color:#888;">&times;</span>
            </div>
            <div style="display:flex;align-items:flex-start;gap:10px;padding:10px 18px 0 18px;">
                <span style="display:inline-block;margin-top:2px;">
                    <svg width="32" height="32" viewBox="0 0 32 32"><circle cx="16" cy="16" r="16" fill="#b5cbe7"/><text x="16" y="22" text-anchor="middle" font-size="20" fill="#1a4b8c" font-family="Arial, sans-serif">i</text></svg>
                </span>
                <span style="font-size:15px;color:#222;line-height:1.5;">E-Return Verified Successfully.</span>
            </div>
            <div style="text-align:center;padding:16px 0 10px 0;">
                <button id="verifySuccessOkBtn" style="padding:3px 32px;background:#e3eaf3;border:1.5px solid #b5cbe7;border-radius:3px;font-size:15px;cursor:pointer;color:#1a4b8c;font-weight:bold;">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Preview Modal -->
    <div id="previewModal" style="display:none;position:fixed;z-index:10000;left:0;top:0;width:100vw;height:100vh;background:#DFE9F6;overflow:hidden;">
        <iframe id="previewIframe" src="" style="width:100%;height:100%;border:none;"></iframe>
    </div>
    
    <script>
        // Enable Preview/Verify if submission number matches d03 submission number
        const submissionInput = document.getElementById('submissionNoInput');
        const previewBtn = document.getElementById('previewBtn');
        const verifyBtn = document.getElementById('verifyBtn');
        const resetBtn = document.getElementById('resetBtn');
        const moduleSelect = document.getElementById('moduleSelect');

        function checkSubmissionInput() {
            // Check if D-03 Return Entry is selected
            const isD03Selected = moduleSelect.value === 'D-03 Return Entry';
            
            if (!isD03Selected) {
                previewBtn.disabled = true;
                verifyBtn.disabled = true;
                return;
            }

            // Get d03 submission number from localStorage
            let d03SubmissionNo = '';
            try {
                const currentUser = sessionStorage.getItem('d03_current_registration');
                if (currentUser) {
                    const userData = JSON.parse(currentUser);
                    d03SubmissionNo = userData.submissionNumber || userData.submissionNo || '';
                } else {
                    const returnData = localStorage.getItem('d03_return_data');
                    if (returnData) {
                        const data = JSON.parse(returnData);
                        d03SubmissionNo = data.submissionNo || '';
                    }
                }
            } catch(e) {}

            // Enable buttons if submission number matches and is finalized
            const isFinalized = localStorage.getItem('d03_finalized') === '1';
            if (submissionInput.value.trim() && d03SubmissionNo && submissionInput.value.trim() === d03SubmissionNo && isFinalized) {
                previewBtn.disabled = false;
                verifyBtn.disabled = false;
            } else {
                previewBtn.disabled = true;
                verifyBtn.disabled = true;
            }
        }
        
        submissionInput.addEventListener('input', checkSubmissionInput);
        moduleSelect.addEventListener('change', checkSubmissionInput);

        resetBtn.onclick = function() {
            submissionInput.value = '';
            moduleSelect.value = '';
            checkSubmissionInput();
        };

        previewBtn.onclick = function() {
            const submissionNo = submissionInput.value.trim();
            document.getElementById('previewIframe').src = '../income_tax/d03_print_pages.html?submissionNo=' + submissionNo;
            document.getElementById('previewModal').style.display = 'flex';
        };
        
        function closePreviewModal() {
            document.getElementById('previewModal').style.display = 'none';
            document.getElementById('previewIframe').src = '';
        }

        verifyBtn.onclick = function() {
            document.getElementById('verifySuccessModal').style.display = 'block';
        };
        
        function hideVerifySuccessModal() {
            document.getElementById('verifySuccessModal').style.display = 'none';
        }
        
        document.getElementById('verifySuccessOkBtn').onclick = hideVerifySuccessModal;
    </script>
</body>
</html>
