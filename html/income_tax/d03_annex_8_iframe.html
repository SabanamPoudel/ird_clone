<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä - ‡•Æ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: Arial, sans-serif;
            padding: 15px;
            background-color: #e8eef7;
            font-size: 12px;
        }
        
        .print-btn {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 5px 15px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }
        
        .page-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #000;
        }
        
        .back-link-section {
            background-color: #d4e4f7;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #b0c4de;
            font-size: 12px;
        }
        
        .back-link {
            color: #ff0000;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .form-section {
            background-color: #dfe9f6;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
        }
        
        .form-row {
            margin-bottom: 8px;
        }
        
        .form-inline {
            display: inline-block;
            margin-right: 20px;
        }
        
        .form-inline label {
            display: inline-block;
            margin-right: 5px;
            min-width: 120px;
        }
        
        .form-inline input,
        .form-inline select {
            padding: 4px;
            border: 1px solid #ccc;
            font-size: 12px;
        }
        
        input[type="text"] {
            width: 150px;
        }
        
        input[readonly] {
            background-color: #f5f5f5;
        }
        
        select {
            width: 400px;
        }
        
        .section-header {
            background-color: #b8d4f1;
            padding: 8px 10px;
            margin: 10px 0 5px 0;
            font-weight: bold;
            border: 1px solid #7da7d9;
            font-size: 13px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fff;
            margin-bottom: 10px;
        }
        
        .data-table tr {
            border-bottom: 1px solid #e0e0e0;
        }
        
        .data-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .data-table tr:hover {
            background-color: #fffacd;
        }
        
        .data-table td {
            padding: 8px 10px;
            vertical-align: middle;
        }
        
        .data-table td:first-child {
            width: 40px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td:nth-child(2) {
            width: auto;
            color: #333;
            line-height: 1.5;
        }
        
        .data-table td:last-child {
            width: 200px;
            text-align: right;
            padding-right: 20px;
        }
        
        .data-table input[type="text"] {
            width: 180px;
            text-align: right;
            padding: 5px;
            border: 1px solid #ccc;
        }
        
        .item-desc-eng {
            color: #555;
            font-size: 11px;
            display: block;
            margin-top: 2px;
        }
        
        .button-group {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        .btn-save {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 6px 15px;
            cursor: pointer;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin-right: 5px;
        }
        
        .btn-save:hover {
            background-color: #e0e0e0;
        }
        
        .btn-save::before {
            content: "üíæ";
            font-size: 14px;
        }
        
        .btn-save.updated::before {
            content: "";
        }
        
        .btn-delete {
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            padding: 6px 15px;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            gap: 5px;
        }
        
        .btn-delete:hover {
            background-color: #e0e0e0;
        }
        
        .btn-delete::before {
            content: "üóëÔ∏è";
            font-size: 14px;
        }
        
        .back-link-bottom {
            margin-top: 15px;
            font-size: 12px;
        }
        
        .back-link-bottom a {
            color: #ff0000;
            text-decoration: none;
        }
        
        .back-link-bottom a:hover {
            text-decoration: underline;
        }
        
        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: #d4e4f7;
            border-radius: 5px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            animation: modalSlideIn 0.3s ease;
            border: 2px solid #8ba8cc;
        }
        
        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 12px 15px;
            border-bottom: 1px solid #8ba8cc;
            font-weight: bold;
            font-size: 16px;
            color: #1e4d8b;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-close:hover {
            color: #000;
        }
        
        .modal-body {
            padding: 30px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .modal-icon {
            font-size: 48px;
            flex-shrink: 0;
        }
        
        .modal-message {
            font-size: 16px;
            color: #333;
            text-align: left;
        }
        
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #8ba8cc;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .modal-btn {
            padding: 10px 40px;
            border: 1px solid #8ba8cc;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            font-weight: normal;
            transition: all 0.2s ease;
            background: linear-gradient(to bottom, #ffffff 0%, #e0e9f5 100%);
            color: #000;
        }
        
        .modal-btn-primary {
            color: #000;
        }
        
        .modal-btn-primary:hover {
            background: linear-gradient(to bottom, #f0f5fa 0%, #d0dcea 100%);
        }
        
        .modal-btn-secondary {
            color: #000;
        }
        
        .modal-btn-secondary:hover {
            background: linear-gradient(to bottom, #f0f5fa 0%, #d0dcea 100%);
        }
    </style>
</head>
<body>
    <button class="print-btn">üñ®Ô∏è Print</button>
    
    <div class="page-title">‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä - ‡•Æ</div>
    
    <div class="back-link-section">
        ‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® <span class="back-link" id="backLink">‡§Ø‡§π‡§æ‡§Å ‡§ï‡§ø‡•ç‡§≤‡§ï</span> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§
    </div>
    
    <div class="form-section">
        <div class="form-row">
            <div class="form-inline">
                <label>‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</label>
                <input type="text" id="fiscalYear" value="2081.082" readonly>
            </div>
            <div class="form-inline" style="float: right;">
                <label>‡§Ü.‡§∞‡§æ.‡§ï‡§æ:</label>
                <input type="text" id="incomeSource" value="‡§Ü‡§®‡•ç‡§§‡§∞‡§ø‡§ï ‡§∞‡§æ‡§ú‡§∏‡•ç‡§µ ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø ‡§≠‡§¶‡•ç‡§∞‡§™‡•Å‡§∞" readonly>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-inline">
                <label>‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞:</label>
                <input type="text" id="pan" value="610015263" readonly>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-inline" style="width: 100%;">
                <label>‡§®‡§æ‡§Æ:</label>
                <input type="text" id="name" value="‡§∂‡•ç‡§∞‡§æ‡§µ‡§æ ‡§µ‡§ø‡§®‡•ã‡§¶‡§∞‡•Ä ‡§∞‡•Å‡§¶‡•ç‡§∞‡•á‡§£‡•Ä ‡§™‡•ç‡§∞‡§æ.‡§µ‡§ø." readonly style="width: 400px;">
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-inline">
                <label>‡§ï‡§∞‡§ï‡•ã ‡§ï‡§ø‡§∏‡§ø‡§Æ:</label>
                <select id="taxType" onchange="updateTaxRate()">
                    <option value="">Select...</option>
                    <option value="shares_365_plus">‡•©‡•¨‡•´ ‡§¶‡§ø‡§® ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§Ö‡§µ‡§ß‡§ø ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ‡§Æ‡§æ ‡§∞‡§π‡•á‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§£ (‡§π‡§ø‡§§)‡§ï‡•ã ‡§®‡§ø‡§É‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§Ü‡§Ø (‡§®‡•á‡§™‡•ç‡§∏‡•á‡§Æ‡§æ ‡§∏‡•Ç‡§ö‡•Ä‡§ï‡•É‡§§ ‡§≠‡§è‡§ï‡•ã)</option>
                    <option value="shares_365_less">‡•©‡•¨‡•´ ‡§¶‡§ø‡§® ‡§µ‡§æ ‡§∏‡•ã ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§Ö‡§µ‡§ß‡§ø ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ‡§Æ‡§æ ‡§∞‡§π‡•á‡§ï‡•ã ‡§∂‡•á‡§Ø‡§∞ ‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§£ (‡§π‡§ø‡§§)‡§ï‡•ã ‡§®‡§ø‡§É‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§Ü‡§Ø (‡§®‡•á‡§™‡•ç‡§∏‡•á‡§Æ‡§æ ‡§∏‡•Ç‡§ö‡•Ä‡§ï‡•É‡§§ ‡§≠‡§è‡§ï‡•ã)</option>
                    <option value="land_5yr_less">‡•´ ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ ‡§≠‡§è‡§ï‡•ã ‡§ú‡§ó‡•ç‡§ó‡§æ ‡§§‡§•‡§æ ‡§ò‡§∞‡§ú‡§ó‡•ç‡§ó‡§æ‡§ï‡•ã ‡§®‡§ø‡§É‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§Ü‡§Ø</option>
                    <option value="land_5yr_plus">‡•´ ‡§µ‡§∞‡•ç‡§∑ ‡§µ‡§æ ‡•´ ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§∏‡•ç‡§µ‡§æ‡§Æ‡§ø‡§§‡•ç‡§µ ‡§≠‡§è‡§ï‡•ã ‡§ú‡§ó‡•ç‡§ó‡§æ ‡§§‡§•‡§æ ‡§ò‡§∞‡§ú‡§ó‡•ç‡§ó‡§æ‡§ï‡•ã ‡§®‡§ø‡§É‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§Ü‡§Ø</option>
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-inline">
                <label>‡§ï‡§∞‡§ï‡•ã ‡§¶‡§∞:</label>
                <input type="text" id="taxRate" value="" readonly>
            </div>
        </div>
    </div>
    
    <!-- ISA Section -->
    <div class="section-header">ISA</div>
    <table class="data-table">
        <tbody>
            <tr>
                <td>1</td>
                <td>
                    ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑‡§Æ‡§æ ‡§∏‡•á‡§Ø‡§∞ ‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§£‡§ï‡•ã ‡§®‡§ø‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§Ü‡§Æ‡•ç‡§¶‡§æ‡§®‡•Ä
                    <span class="item-desc-eng">Total Income from Disposed Shares and Securities of current fiscal year</span>
                </td>
                <td>
                    <input type="text" id="isa1" value="0" oninput="calculateISA()">
                </td>
            </tr>
            <tr>
                <td>2</td>
                <td>
                    ‡§®‡§ø‡§∏‡§∞‡•ç‡§ó ‡§≠‡§è‡§ï‡•ã ‡§∏‡•á‡§Ø‡§∞ ‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§£‡§ï‡•ã ‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø
                    <span class="item-desc-eng">Total Purchased Amount of disposed securities</span>
                </td>
                <td>
                    <input type="text" id="isa2" value="0" oninput="calculateISA()">
                </td>
            </tr>
            <tr>
                <td>3</td>
                <td>
                    ‡§∏‡•á‡§Ø‡§∞ ‡§µ‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ‡§ï‡•ã ‡§®‡§ø‡§∏‡§∞‡•ç‡§ó‡§¨‡§æ‡§ü ‡§≠‡§è‡§ï‡•ã ‡§≤‡§æ‡§≠ ‡§µ‡§æ ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä (‡•ß - ‡•®)
                    <span class="item-desc-eng"></span>
                </td>
                <td>
                    <input type="text" id="isa3" value="0" readonly>
                </td>
            </tr>
        </tbody>
    </table>
    
    <!-- DL Section -->
    <div class="section-header">Deductible Loss (DL)</div>
    <table class="data-table">
        <tbody>
            <tr>
                <td>4</td>
                <td>
                    ‡§Ø‡§∏ ‡§Ü.‡§¨.‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø ‡§µ‡§æ ‡§∞ ‡§∞ ‡§≤‡§ó‡§æ‡§®‡•Ä‡§ï‡•ã ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä
                    <span class="item-desc-eng">Losses transferred from other Businesses and/or Investments in this Year</span>
                </td>
                <td>
                    <input type="text" id="dl1" value="0" oninput="calculateDL()">
                </td>
            </tr>
            <tr>
                <td>5</td>
                <td>
                    ‡§ó‡§§ ‡§µ‡§∞‡•ç‡§∑‡§¨‡§æ‡§ü ‡§ú‡§ø‡§Æ‡•ç‡§Æ‡•á‡§µ‡§æ‡§∞‡•Ä ‡§∏‡§∞‡•á‡§ï‡•ã ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä
                    <span class="item-desc-eng">Carried forward of unrelieved Investments from previous Years</span>
                </td>
                <td>
                    <input type="text" id="dl2" value="0" oninput="calculateDL()">
                </td>
            </tr>
            <tr>
                <td>6</td>
                <td>
                    ‡§ú‡§Æ‡•ç‡§Æ‡§æ : (‡•™ ‡§¶‡•á‡§ñ‡§ø ‡•´)
                    <span class="item-desc-eng">Total:( 4 to 5)</span>
                </td>
                <td>
                    <input type="text" id="dl3" value="0" readonly>
                </td>
            </tr>
            <tr>
                <td>7</td>
                <td>
                    ‡§ñ‡•Å‡§¶ ‡§≤‡§æ‡§≠ / ‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä : (‡•© - ‡•¨)
                    <span class="item-desc-eng"></span>
                </td>
                <td>
                    <input type="text" id="dl4" value="0" readonly>
                </td>
            </tr>
        </tbody>
    </table>
    
    <div class="button-group">
        <button class="btn-save" id="saveBtn" onclick="saveAnnex8()">Save</button>
        <button class="btn-delete" id="deleteBtn" onclick="deleteAnnex8()">Delete</button>
    </div>
    
    <div class="back-link-bottom">
        ‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® <a href="#" id="backLinkBottom">‡§Ø‡§π‡§æ‡§Å ‡§ï‡§ø‡•ç‡§≤‡§ï</a> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§
    </div>
    
    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>SUCCESS</span>
                <button class="modal-close" onclick="closeSuccessModal()">‚úñ</button>
            </div>
            <div class="modal-body">
                <div class="modal-icon">‚ÑπÔ∏è</div>
                <div class="modal-message">Successfully saved</div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="closeSuccessModal()">OK</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <span>Confirm Action</span>
                <button class="modal-close" onclick="closeConfirmModal()">‚úñ</button>
            </div>
            <div class="modal-body">
                <div class="modal-icon">‚ùì</div>
                <div class="modal-message">‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ?</div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-primary" onclick="confirmGoBack()">Yes</button>
                <button class="modal-btn modal-btn-secondary" onclick="closeConfirmModal()">No</button>
            </div>
        </div>
    </div>
    
    <script>
        // Load saved data on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadD03FormData();
            loadAnnex8Data();
            calculateISA();
            calculateDL();
        });
        
        // Load D03 form data (fiscal year, PAN, name, IRO)
        function loadD03FormData() {
            const d03Data = localStorage.getItem('d03_return_data');
            if (d03Data) {
                const data = JSON.parse(d03Data);
                document.getElementById('fiscalYear').value = data.fiscalYear || '';
                document.getElementById('pan').value = data.pan || '';
                document.getElementById('name').value = data.taxpayerName || data.username || '';
                document.getElementById('incomeSource').value = data.iro || '';
            }
        }
        
        // Update tax rate based on selected tax type
        function updateTaxRate() {
            const taxType = document.getElementById('taxType').value;
            const taxRateInput = document.getElementById('taxRate');
            
            // Define tax rates for each type
            const taxRates = {
                'shares_365_plus': '5',      // > 365 days shares
                'shares_365_less': '7.5',    // ‚â§ 365 days shares
                'land_5yr_less': '7.5',      // < 5 years land
                'land_5yr_plus': '5'         // ‚â• 5 years land
            };
            
            taxRateInput.value = taxRates[taxType] || '';
        }
        
        // Calculation functions
        function calculateISA() {
            const isa1 = parseFloat(document.getElementById('isa1').value) || 0;
            const isa2 = parseFloat(document.getElementById('isa2').value) || 0;
            const isa3 = isa1 - isa2;
            document.getElementById('isa3').value = isa3.toFixed(2);
            calculateDL();
        }
        
        function calculateDL() {
            const dl1 = parseFloat(document.getElementById('dl1').value) || 0;
            const dl2 = parseFloat(document.getElementById('dl2').value) || 0;
            const dl3 = dl1 + dl2;
            document.getElementById('dl3').value = dl3.toFixed(2);
            
            const isa3 = parseFloat(document.getElementById('isa3').value) || 0;
            const dl4 = isa3 - dl3;
            document.getElementById('dl4').value = dl4.toFixed(2);
        }
        
        // Save function
        function saveAnnex8() {
            const data = {
                fiscalYear: document.getElementById('fiscalYear').value,
                incomeSource: document.getElementById('incomeSource').value,
                pan: document.getElementById('pan').value,
                name: document.getElementById('name').value,
                taxType: document.getElementById('taxType').value,
                taxRate: document.getElementById('taxRate').value,
                isa1: document.getElementById('isa1').value,
                isa2: document.getElementById('isa2').value,
                isa3: document.getElementById('isa3').value,
                dl1: document.getElementById('dl1').value,
                dl2: document.getElementById('dl2').value,
                dl3: document.getElementById('dl3').value,
                dl4: document.getElementById('dl4').value
            };
            
            localStorage.setItem('annex8_data', JSON.stringify(data));
            localStorage.setItem('d03_annex8_saved', 'true');
            
            // Show success modal
            document.getElementById('successModal').classList.add('active');
        }
        
        // Load saved data
        function loadAnnex8Data() {
            const savedData = localStorage.getItem('annex8_data');
            if (savedData) {
                const data = JSON.parse(savedData);
                document.getElementById('fiscalYear').value = data.fiscalYear || '';
                document.getElementById('incomeSource').value = data.incomeSource || '';
                document.getElementById('pan').value = data.pan || '';
                document.getElementById('name').value = data.name || '';
                document.getElementById('taxType').value = data.taxType || '';
                document.getElementById('taxRate').value = data.taxRate || '';
                document.getElementById('isa1').value = data.isa1 || '0';
                document.getElementById('isa2').value = data.isa2 || '0';
                document.getElementById('isa3').value = data.isa3 || '0';
                document.getElementById('dl1').value = data.dl1 || '0';
                document.getElementById('dl2').value = data.dl2 || '0';
                document.getElementById('dl3').value = data.dl3 || '0';
                document.getElementById('dl4').value = data.dl4 || '0';
                
                // Change button to Update
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.textContent = 'Update';
                saveBtn.classList.add('updated');
                
                // Show delete button
                const deleteBtn = document.getElementById('deleteBtn');
                deleteBtn.style.display = 'inline-flex';
            }
        }
        
        // Close success modal
        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
            
            // Change button to Update after saving
            const saveBtn = document.getElementById('saveBtn');
            saveBtn.textContent = 'Update';
            saveBtn.classList.add('updated');
            
            // Show delete button
            const deleteBtn = document.getElementById('deleteBtn');
            deleteBtn.style.display = 'inline-flex';
            
            // Notify parent to show link
            window.parent.postMessage({type: 'annex8Saved'}, '*');
        }
        
        // Delete function
        function deleteAnnex8() {
            if (confirm('‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§Ø‡•ã ‡§°‡§æ‡§ü‡§æ ‡§Æ‡•á‡§ü‡§æ‡§â‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ?')) {
                localStorage.removeItem('annex8_data');
                localStorage.removeItem('d03_annex8_saved');
                
                // Reset form
                document.getElementById('taxType').value = '';
                document.getElementById('taxRate').value = '';
                document.getElementById('isa1').value = '0';
                document.getElementById('isa2').value = '0';
                document.getElementById('isa3').value = '0';
                document.getElementById('dl1').value = '0';
                document.getElementById('dl2').value = '0';
                document.getElementById('dl3').value = '0';
                document.getElementById('dl4').value = '0';
                
                // Change button back to Save
                const saveBtn = document.getElementById('saveBtn');
                saveBtn.textContent = 'Save';
                saveBtn.classList.remove('updated');
                
                // Hide delete button
                const deleteBtn = document.getElementById('deleteBtn');
                deleteBtn.style.display = 'none';
                
                // Notify parent to hide link
                window.parent.postMessage({type: 'annex8Deleted'}, '*');
                
                alert('‡§°‡§æ‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Æ‡•á‡§ü‡§æ‡§á‡§Ø‡•ã‡•§');
            }
        }
        
        // Back navigation with confirmation
        document.getElementById('backLink').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('confirmModal').classList.add('active');
        });
        
        document.getElementById('backLinkBottom').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('confirmModal').classList.add('active');
        });
        
        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }
        
        function confirmGoBack() {
            window.location.href = 'd03_set_annex.html';
        }
    </script>
</body>
</html>
