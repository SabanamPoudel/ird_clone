<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Annex-13(Ka) - Income Tax Form</title>
    <link rel="stylesheet" href="../../extjs/resources/ext-all.css">
    <link rel="stylesheet" href="../../css/all.css">
    <link rel="stylesheet" href="../../css/taxpayer_portal.css">
    <link rel="stylesheet" href="../../css/income_tax/d01_return_entry.css">
    <style>
        body { margin: 0; padding: 0; background: #DFE9F6; font-family: Arial, sans-serif; }
        .x-panel { background: white; border: 1px solid #BED7EB; margin-bottom: 10px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .x-panel-header { background: linear-gradient(180deg, #B7D3F3 0%, #8DB3E3 100%); color: white; padding: 8px 12px; font-weight: bold; border-bottom: 1px solid #7FA8D1; }
        .x-panel-body { padding: 10px; }
        .x-fieldset { border: 1px solid #BED7EB; margin: 5px 0; padding: 10px; background: #F3F6FB; }
        .x-fieldset-header { background: #DCE6F1; padding: 6px 10px; font-weight: bold; border-bottom: 1px solid #BED7EB; }
        .x-field { margin: 8px 0; }
        .x-field-label { font-weight: bold; color: #333; margin-right: 10px; display: inline-block; }
        input[type="text"], input[type="number"] { border: 1px solid #BED7EB; padding: 4px 6px; background: white; width: 95%; }
        input[readonly] { background: #F0F0F0; color: #666; }
        .x-btn { background: linear-gradient(180deg, #E8E8E8 0%, #D0D0D0 100%); border: 1px solid #999; padding: 6px 12px; cursor: pointer; margin: 5px 2px; font-size: 12px; border-radius: 3px; }
        .x-btn:hover { background: linear-gradient(180deg, #F5F5F5 0%, #E0E0E0 100%); }
        .x-btn:active { background: linear-gradient(180deg, #D0D0D0 0%, #B0B0B0 100%); }
        table { width: 100%; border-collapse: collapse; background: white; }
        table th { background: #DCE6F1; border: 1px solid #BED7EB; padding: 6px; font-weight: bold; text-align: left; }
        table td { border: 1px solid #BED7EB; padding: 6px; vertical-align: middle; }
        .TxtRight { text-align: right; }
        .TxtCenter { text-align: center; }
        .x-grid-header { background: #DCE6F1; border-bottom: 1px solid #BED7EB; }
        .x-toolbar { background: #F3F6FB; border-bottom: 1px solid #BED7EB; padding: 8px; margin-bottom: 10px; }
        .back-link-panel { background: #E8F1F8; border: 1px solid #7FA8D1; padding: 10px; margin: 10px 0; border-radius: 2px; }
        .section-title { font-size: 16px; font-weight: bold; text-align: center; margin: 15px 0; color: #333; }
    </style>
</head>
<body>
    <div id="CntMainPage" class="x-container x-box-layout-ct" style="margin: 0; width: 100%; background: #DFE9F6; padding: 10px;">
        <div id="ext-comp-1307" class="x-panel">
            <!-- Main Panel Header -->
            <div id="header-1429" class="x-panel-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Annex-13(Ka)</span>
                    <button class="x-btn" onclick="window.print();" title="Print this form">
                        <span style="margin-right: 5px;">üñ®</span>Print
                    </button>
                </div>
            </div>

            <!-- Panel Body -->
            <div id="ext-comp-1307-body" class="x-panel-body" style="background: white; padding: 15px;">
                <!-- Form Title -->
                <div class="section-title">‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä - ‡•ß‡•© (‡§ï)</div>

                <!-- Back Link Navigation Panel -->
                <div id="panel-back-nav" class="x-panel">
                    <div id="header-back" class="x-panel-header">
                        <div class="back-link-panel" style="margin: 0; background: transparent; border: none; padding: 0;">
                            <span style="color: black;">‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® </span>
                            <span id="lnkRedirectD02" style="cursor: pointer; color: red; text-decoration: underline; font-weight: bold;">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span>
                            <span style="color: black;"> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
                        </div>
                    </div>
                </div>

                <!-- Submission Details Section -->
                <div id="panel-submission" class="x-panel" style="margin: 10px 0;">
                    <div class="x-panel-header">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <div class="x-panel-body">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 33%; vertical-align: top;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§®‡§Ç.:</label>
                                        <input type="text" id="txtSubmissionNo" readonly style="width: 90%;" />
                                    </div>
                                </td>
                                <td style="width: 33%; vertical-align: top;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</label>
                                        <input type="text" id="txtFiscalYear" readonly style="width: 90%;" />
                                    </div>
                                </td>
                                <td style="width: 34%; vertical-align: top;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞:</label>
                                        <input type="text" id="txtPAN" readonly style="width: 90%;" />
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Financial Description Grid Section -->
                <div id="panel-fin-desc" class="x-panel" style="margin: 10px 0;">
                    <div class="x-panel-header">‡§µ‡§ø‡§§‡•ç‡§§‡§ø‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</div>
                    <div class="x-panel-body">
                        <table style="width: 100%;">
                            <thead>
                                <tr>
                                    <th style="width: 70%;">‡§∏‡•Å‡§ö‡•Ä</th>
                                    <th style="width: 30%;">‡§∞‡§ï‡§Æ ‡§µ‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∏‡§§</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>
                                        <div>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br/><small style="color: #666;">Sales This Year</small></div>
                                    </td>
                                    <td>
                                        <input type="text" id="txtFinDesc0" class="TxtRight" placeholder="0" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div>‡§∏‡•á‡§µ‡§æ ‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞<br/><small style="color: #666;">Services and Sales of Business</small></div>
                                    </td>
                                    <td>
                                        <input type="text" id="txtFinDesc1" class="TxtRight" placeholder="0" />
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <div>‡§ï‡§∞ ‡§Ö‡§ò‡§ø‡§ï‡•ã ‡§ñ‡•Å‡§¶ ‡§Ü‡§Ø/‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br/><small style="color: #666;">Net Profit / Loss Before Tax This Year</small></div>
                                    </td>
                                    <td>
                                        <input type="text" id="txtFinDesc2" class="TxtRight" placeholder="0" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div style="padding: 10px 0;">
                            <button class="x-btn" onclick="saveFinancialDescription();" title="Save financial description">
                                üíæ Save
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Less Than 100k Transaction Section -->
                <div id="panel-less-100k" class="x-panel" style="margin: 10px 0;">
                    <div class="x-panel-header">‡§∞‡•Å ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¨‡§ø‡§µ‡§∞‡§£</div>
                    <div class="x-panel-body">
                        <table style="width: 100%;">
                            <tr>
                                <td>
                                    <span>‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§è‡§ï‡§Æ‡•Å‡§∑‡•ç‡§† ‡§∞‡§ï‡§Æ </span>
                                </td>
                                <td style="width: 150px;">
                                    <input type="text" id="txtLess100k" class="TxtRight" placeholder="0" />
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Greater Than 100k Comprehensive Section -->
                <div id="panel-greater-100k-desc" class="x-panel" style="margin: 10px 0;">
                    <div class="x-panel-header">‡§∂‡•Å‡§∞‡•Å ‡§Æ‡•å‡§ú‡•ç‡§¶‡§æ‡§§, ‡§ñ‡§∞‡§ø‡§¶, ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä, ‡§≤‡§ø‡§®‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§µ‡§æ ‡§¶‡§ø‡§®‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§∏‡§¨‡•à ‡§∞‡§ï‡§Æ ‡§∞‡•Å ‡•ß ‡§≤‡§æ‡§ñ ‡§µ‡§æ ‡§∏‡•ã ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§π‡•Å‡§®‡•á‡§ï‡•ã ‡§è‡§ï‡§Æ‡•Å‡§∑‡•ç‡§ü ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <div class="x-panel-body">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∂‡•Å‡§∞‡•Å‡§ï‡•ã ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§¶‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä) ‡§∞‡§ï‡§Æ:</label>
                                        <input type="text" id="txtYrStartDebit" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶:</label>
                                        <input type="text" id="txtCapitalServiceBuy" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶:</label>
                                        <input type="text" id="txtOtherServiceBuy" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶:</label>
                                        <input type="text" id="txtYrOtherGoodsBuy" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶:</label>
                                        <input type="text" id="txtYrCapitalGoodsBuy" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§∏‡•á‡§µ‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø:</label>
                                        <input type="text" id="txtYrServiceSale" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§® ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø:</label>
                                        <input type="text" id="txtYrGoodsSale" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                                <td style="width: 50%;">
                                    <div class="x-field">
                                        <label class="x-field-label">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§Ö‡§®‡•ç‡§§‡§Æ‡§æ ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§¶‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä) ‡§∞‡§ï‡§Æ:</label>
                                        <input type="text" id="txtYrEndDebit" class="TxtRight" placeholder="0" />
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <!-- Greater Than 100k Transaction Section -->
                <div id="panel-greater-100k" class="x-panel" style="margin: 10px 0;">
                    <div class="x-panel-header">‡§∂‡•Å‡§∞‡•Å ‡§Æ‡•å‡§ú‡•ç‡§¶‡§æ‡§§, ‡§ñ‡§∞‡§ø‡§¶, ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä, ‡§≤‡§ø‡§® ‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§µ‡§æ ‡§¶‡§ø‡§® ‡§¨‡§æ‡§Å‡§ï‡•Ä ‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ï‡•Å‡§®‡•à ‡§∞‡§ï‡§Æ ‡§∞‡•Å ‡•ß ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§π‡•Å‡§®‡•á‡§ï‡•ã ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <div class="x-panel-body">
                        <div style="margin: 10px 0; padding: 10px; background: #F9F9F9; border: 1px solid #DDD;">
                            <label style="display: inline-block; margin-right: 10px;">
                                <span>‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä‡§ï‡•ã ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞ ‡§õ‡•à‡§® </span>
                            </label>
                            <input type="checkbox" id="chkNoGreater100k" checked />
                        </div>

                        <!-- Transaction Grid (Hidden by default) -->
                        <div id="divTransactionGrid" style="display: none; margin-top: 10px;">
                            <div class="x-toolbar" style="margin: 10px 0; padding: 8px; background: #F3F6FB;">
                                <button class="x-btn" onclick="addTransactionRow();" title="Add new transaction row">
                                    ‚ûï Add New
                                </button>
                                <button class="x-btn" onclick="deleteAllTransactionRows();" title="Delete all rows">
                                    üóë Delete All
                                </button>
                                <button class="x-btn" onclick="checkTransactionSum();" title="Check sum of transactions">
                                    üßÆ Check Sum
                                </button>
                            </div>

                            <table id="tblTransactions" style="width: 100%; margin-bottom: 10px;">
                                <thead>
                                    <tr class="x-grid-header">
                                        <th style="width: 5%;">‡§ï‡•ç‡§∞.‡§Æ.</th>
                                        <th style="width: 10%;">‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞</th>
                                        <th style="width: 20%;">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                                        <th style="width: 15%;">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∂‡•Å‡§∞‡•Å‡§ï‡•ã ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä</th>
                                        <th style="width: 12%;">‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶</th>
                                        <th style="width: 12%;">‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶</th>
                                        <th style="width: 12%;">‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶</th>
                                        <th style="width: 12%;">‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶</th>
                                        <th style="width: 12%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§∏‡•á‡§µ‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø</th>
                                        <th style="width: 12%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§® ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø</th>
                                        <th style="width: 15%;">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§Ö‡§®‡•ç‡§§‡§Æ‡§æ ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä</th>
                                        <th style="width: 8%;">Action</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionTableBody">
                                    <!-- Transaction rows will be added here -->
                                </tbody>
                            </table>

                            <!-- Totals Section -->
                            <div id="panel-totals" class="x-fieldset" style="margin-top: 10px;">
                                <div class="x-fieldset-header">‡§ú‡§Æ‡•ç‡§Æ‡§æ</div>
                                <table style="width: 100%;">
                                    <tr>
                                        <td style="width: 20%;"><label class="x-field-label">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∂‡•Å‡§∞‡•Å‡§ï‡•ã ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä:</label></td>
                                        <td style="width: 15%;"><input type="text" id="totalYrStartDebit" readonly class="TxtRight" /></td>
                                        
                                        <td style="width: 20%;"><label class="x-field-label">‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶:</label></td>
                                        <td style="width: 15%;"><input type="text" id="totalCapitalService" readonly class="TxtRight" /></td>
                                        
                                        <td style="width: 20%;"><label class="x-field-label">‡§Ö‡§®‡•ç‡§Ø ‡§∏‡•á‡§µ‡§æ ‡§ñ‡§∞‡§ø‡§¶:</label></td>
                                        <td style="width: 15%;"><input type="text" id="totalOtherService" readonly class="TxtRight" /></td>
                                    </tr>
                                    <tr>
                                        <td><label class="x-field-label">‡§™‡•Å‡§ú‡§ø‡§ó‡§§ ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶:</label></td>
                                        <td><input type="text" id="totalCapitalGoods" readonly class="TxtRight" /></td>
                                        
                                        <td><label class="x-field-label">‡§Ö‡§®‡•ç‡§Ø ‡§∏‡§Æ‡§æ‡§® ‡§ñ‡§∞‡§ø‡§¶:</label></td>
                                        <td><input type="text" id="totalOtherGoods" readonly class="TxtRight" /></td>
                                        
                                        <td><label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ï‡•ã ‡§∏‡•á‡§µ‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø:</label></td>
                                        <td><input type="text" id="totalServiceSale" readonly class="TxtRight" /></td>
                                    </tr>
                                    <tr>
                                        <td><label class="x-field-label">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§∏‡§Æ‡§æ‡§® ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø:</label></td>
                                        <td><input type="text" id="totalGoodsSale" readonly class="TxtRight" /></td>
                                        
                                        <td><label class="x-field-label">‡§µ‡§∞‡•ç‡§∑‡§ï‡•ã ‡§Ö‡§®‡•ç‡§§‡§Æ‡§æ ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä:</label></td>
                                        <td><input type="text" id="totalYrEndDebit" readonly class="TxtRight" /></td>
                                        
                                        <td colspan="2"></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <div style="padding: 10px 0; margin-top: 10px;">
                            <button class="x-btn" onclick="saveAnnex13();" title="Save transaction data">
                                üíæ Save Transaction
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Bottom Navigation -->
                <div id="panel-bottom-nav" class="x-panel" style="margin: 15px 0;">
                    <div class="x-toolbar" style="background: #F9F9F9; border: 1px solid #DDD; padding: 10px;">
                        <span style="margin-right: 10px;">‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§®</span>
                        <a href="#" id="lnkBottomRedirect" style="color: red; text-decoration: underline; margin: 0 5px;">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</a>
                        <span>‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Load from sessionStorage on page load
        window.addEventListener('load', function() {
            loadAnnex13Data();
        });

        function loadAnnex13Data() {
            try {
                const data = sessionStorage.getItem('d02FormData');
                if (data) {
                    const formData = JSON.parse(data);
                    document.getElementById('txtSubmissionNo').value = formData.submissionNo || '';
                    document.getElementById('txtFiscalYear').value = formData.fiscalYear || '';
                    document.getElementById('txtPAN').value = formData.pan || '';
                }
            } catch (e) {
                console.log('No D-02 data found in sessionStorage');
            }
        }

        function saveFinancialDescription() {
            const desc0 = document.getElementById('txtFinDesc0').value;
            const desc1 = document.getElementById('txtFinDesc1').value;
            const desc2 = document.getElementById('txtFinDesc2').value;
            
            sessionStorage.setItem('annex13FinDesc', JSON.stringify({
                sales: desc0,
                serviceSales: desc1,
                netProfit: desc2
            }));
            alert('Financial description saved!');
        }

        function addTransactionRow() {
            const tbody = document.getElementById('transactionTableBody');
            const rowNum = tbody.children.length + 1;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="TxtCenter">${rowNum}</td>
                <td><input type="text" class="transactionPAN" placeholder="PAN" /></td>
                <td><input type="text" class="transactionName" placeholder="Business Name" /></td>
                <td><input type="text" class="transactionYrStart TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionCapSvc TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionOthSvc TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionCapGds TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionOthGds TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionSvcSale TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionGdsSale TxtRight" placeholder="0" /></td>
                <td><input type="text" class="transactionYrEnd TxtRight" placeholder="0" /></td>
                <td><button class="x-btn" onclick="deleteTransactionRow(this)" style="margin: 0; padding: 2px 5px;">üóë</button></td>
            `;
            tbody.appendChild(row);
        }

        function deleteTransactionRow(btn) {
            btn.closest('tr').remove();
            updateRowNumbers();
        }

        function deleteAllTransactionRows() {
            if (confirm('Delete all transaction rows?')) {
                document.getElementById('transactionTableBody').innerHTML = '';
                clearTotals();
            }
        }

        function updateRowNumbers() {
            const tbody = document.getElementById('transactionTableBody');
            Array.from(tbody.children).forEach((row, index) => {
                row.cells[0].textContent = index + 1;
            });
        }

        function checkTransactionSum() {
            const tbody = document.getElementById('transactionTableBody');
            const rows = tbody.querySelectorAll('tr');
            
            let totals = {
                yrStart: 0, capSvc: 0, othSvc: 0, capGds: 0, othGds: 0,
                svcSale: 0, gdsSale: 0, yrEnd: 0
            };

            rows.forEach(row => {
                totals.yrStart += parseFloat(row.querySelector('.transactionYrStart').value) || 0;
                totals.capSvc += parseFloat(row.querySelector('.transactionCapSvc').value) || 0;
                totals.othSvc += parseFloat(row.querySelector('.transactionOthSvc').value) || 0;
                totals.capGds += parseFloat(row.querySelector('.transactionCapGds').value) || 0;
                totals.othGds += parseFloat(row.querySelector('.transactionOthGds').value) || 0;
                totals.svcSale += parseFloat(row.querySelector('.transactionSvcSale').value) || 0;
                totals.gdsSale += parseFloat(row.querySelector('.transactionGdsSale').value) || 0;
                totals.yrEnd += parseFloat(row.querySelector('.transactionYrEnd').value) || 0;
            });

            document.getElementById('totalYrStartDebit').value = totals.yrStart.toFixed(2);
            document.getElementById('totalCapitalService').value = totals.capSvc.toFixed(2);
            document.getElementById('totalOtherService').value = totals.othSvc.toFixed(2);
            document.getElementById('totalCapitalGoods').value = totals.capGds.toFixed(2);
            document.getElementById('totalOtherGoods').value = totals.othGds.toFixed(2);
            document.getElementById('totalServiceSale').value = totals.svcSale.toFixed(2);
            document.getElementById('totalGoodsSale').value = totals.gdsSale.toFixed(2);
            document.getElementById('totalYrEndDebit').value = totals.yrEnd.toFixed(2);

            alert('Totals calculated!');
        }

        function clearTotals() {
            document.getElementById('totalYrStartDebit').value = '';
            document.getElementById('totalCapitalService').value = '';
            document.getElementById('totalOtherService').value = '';
            document.getElementById('totalCapitalGoods').value = '';
            document.getElementById('totalOtherGoods').value = '';
            document.getElementById('totalServiceSale').value = '';
            document.getElementById('totalGoodsSale').value = '';
            document.getElementById('totalYrEndDebit').value = '';
        }

        function saveAnnex13() {
            alert('Annex-13 data saved successfully!');
        }

        // Back navigation
        document.getElementById('lnkRedirectD02').addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof window.parent.loadInParentIframe === 'function') {
                window.parent.loadInParentIframe('income_tax/d02_main_form.html');
            } else {
                console.log('Parent iframe navigation function not available');
            }
        });

        document.getElementById('lnkBottomRedirect').addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof window.parent.loadInParentIframe === 'function') {
                window.parent.loadInParentIframe('income_tax/d02_main_form.html');
            } else {
                console.log('Parent iframe navigation function not available');
            }
        });

        // Toggle transaction grid based on checkbox
        document.getElementById('chkNoGreater100k').addEventListener('change', function() {
            document.getElementById('divTransactionGrid').style.display = this.checked ? 'none' : 'block';
        });
    </script>
</body>
</html>
                    <div class="section-header">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr>
                            <td style="width: 30%;">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§®‡§Ç.:</td>
                            <td><input type="text" id="submissionNo" readonly /></td>
                            <td style="width: 30%;">‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</td>
                            <td><input type="text" id="fiscalYear" readonly /></td>
                        </tr>
                        <tr>
                            <td>‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞:</td>
                            <td colspan="3"><input type="text" id="panNo" readonly style="width: 100%;" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Financial Description Panel -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§µ‡§ø‡§§‡•ç‡§§‡§ø‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</div>
                    <table>
                        <thead>
                            <tr style="background: #DCE6F1;">
                                <th style="width: 50%; text-align: left;">‡§∏‡•Å‡§ö‡•Ä</th>
                                <th style="width: 50%; text-align: left;">‡§∞‡§ï‡§Æ ‡§µ‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br><span style="font-size: 12px; color: #666;">Sales This Year</span></td>
                                <td><input type="text" id="txtFinDesc0" class="TxtRight" /></td>
                            </tr>
                            <tr>
                                <td>‡§∏‡•á‡§µ‡§æ ‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞<br><span style="font-size: 12px; color: #666;">Services and Sales of Business</span></td>
                                <td><input type="text" id="txtFinDesc1" class="TxtRight" /></td>
                            </tr>
                            <tr>
                                <td>‡§ï‡§∞ ‡§Ö‡§ò‡§ø‡§ï‡•ã ‡§ñ‡•Å‡§¶ ‡§Ü‡§Ø/‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br><span style="font-size: 12px; color: #666;">Net Profit / Loss Before Tax This Year</span></td>
                                <td><input type="text" id="txtFinDesc2" class="TxtRight" /></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Save Button -->
                <div style="margin: 15px 0;">
                    <button class="x-btn" onclick="saveAnnex13();">
                        üíæ Save
                    </button>
                </div>

                <!-- Less than 100,000 Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∞‡•Å ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¨‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr>
                            <td>‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§è‡§ï‡§Æ‡•Å‡§∑‡•ç‡§† ‡§∞‡§ï‡§Æ</td>
                            <td><input type="text" id="lessThan100k" class="TxtRight" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Greater than 100,000 Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∞‡•Å ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr style="background: #EFF5FB;">
                            <td colspan="2">
                                <input type="checkbox" id="chkTransaction" /> ‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä‡§ï‡•ã ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞ ‡§õ‡•à‡§®
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Load From Excel Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0; padding: 10px;">
                    <div class="section-header">‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§´‡§æ‡§á‡§≤‡§¨‡§æ‡§ü ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</div>
                    <div style="padding: 10px;">
                        <label>‡§≤‡•ã‡§° XLS: </label>
                        <input type="file" id="excelFile" accept=".xls,.xlsx" />
                        <button class="x-btn" onclick="alert('Upload functionality coming soon');">‚¨Ü Upload</button>
                        <button class="x-btn" onclick="alert('Sample view coming soon');">üìã View Sample</button>
                    </div>
                </div>

                <!-- Transaction Grid Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∂‡•Å‡§∞‡•Å ‡§Æ‡•å‡§ú‡•ç‡§¶‡§æ‡§§, ‡§ñ‡§∞‡§ø‡§¶, ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä)</div>
                    <div style="overflow-x: auto; margin: 10px 0;">
                        <table style="min-width: 100%; font-size: 12px;">
                            <thead>
                                <tr style="background: #DCE6F1;">
                                    <th style="width: 5%;">‡§ï‡•ç‡§∞.</th>
                                    <th style="width: 15%;">‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞</th>
                                    <th style="width: 25%;">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                                    <th style="width: 15%;">‡§∂‡•Å‡§∞‡•Å ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§∞‡§ï‡§Æ)</th>
                                    <th style="width: 15%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ñ‡§∞‡§ø‡§¶</th>
                                    <th style="width: 15%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø</th>
                                    <th style="width: 15%;">‡§Ö‡§®‡•ç‡§§ ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§∞‡§ï‡§Æ)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>‡•ß</td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                </tr>
                                <tr>
                                    <td>‡•®</td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button class="x-btn" onclick="addTransactionRow();">‚ûï Add New</button>
                    <button class="x-btn" onclick="deleteAllRows();">‚ùå Delete All</button>
                    <button class="x-btn" onclick="checkSum();">üßÆ Check Sum</button>
                </div>

                <!-- Totals Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§ú‡§Æ‡•ç‡§Æ‡§æ</div>
                    <table>
                        <tr>
                            <td style="width: 30%;">‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∞‡§ï‡§Æ:</td>
                            <td><input type="text" id="totalSales" readonly class="TxtRight" /></td>
                            <td style="width: 30%;">‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§ñ‡§∞‡§ø‡§¶ ‡§∞‡§ï‡§Æ:</td>
                            <td><input type="text" id="totalPurchase" readonly class="TxtRight" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Save Transaction Button -->
                <div style="margin: 15px 0;">
                    <button class="x-btn" onclick="saveTransaction();">
                        üíæ Save Transaction
                    </button>
                </div>

                <!-- Back Link at Bottom -->
                <div style="background: #E8F4FF; border: 1px solid #5B9BD5; padding: 10px; margin: 10px 0; border-radius: 4px; text-align: center;">
                    <span style="color: #003366;">‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® </span>
                    <span id="lnkRedirectD02Bottom" style="cursor: pointer; color: red; text-decoration: underline; font-weight: bold;">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span>
                    <span style="color: #003366;"> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global loadInParentIframe function for consistency
        window.loadInParentIframe = function(url) {
            try {
                if (parent && parent.loadInParentIframe && parent !== window) {
                    parent.loadInParentIframe(url);
                } else {
                    window.open(url, '_blank');
                }
            } catch (e) {
                console.error('Error in loadInParentIframe:', e);
                window.open(url, '_blank');
            }
        };

        // Handle back links to D-02
        document.getElementById('lnkRedirectD02').addEventListener('click', function(e) {
            e.preventDefault();
            loadInParentIframe('income_tax/d02_main_form.html');
        });
        
        document.getElementById('lnkRedirectD02Bottom').addEventListener('click', function(e) {
            e.preventDefault();
            loadInParentIframe('income_tax/d02_main_form.html');
        });

        // Form functions
        function saveAnnex13() {
            alert('Financial description saved (demo)');
        }

        function addTransactionRow() {
            alert('Add new transaction row (demo)');
        }

        function deleteAllRows() {
            if (confirm('Delete all transaction rows?')) {
                alert('All rows deleted (demo)');
            }
        }

        function checkSum() {
            alert('Check Sum calculation (demo)');
        }

        function saveTransaction() {
            alert('Transaction saved (demo)');
        }

        // Load data from D-02 if available
        window.onload = function() {
            const d02Data = JSON.parse(sessionStorage.getItem('d02_current_registration') || '{}');
            if (d02Data.submissionNo) {
                document.getElementById('submissionNo').value = d02Data.submissionNo;
            }
            if (d02Data.fiscalYear) {
                document.getElementById('fiscalYear').value = d02Data.fiscalYear;
            }
            if (d02Data.pan) {
                document.getElementById('panNo').value = d02Data.pan;
            }
        };
    </script>
</body>
</html>
