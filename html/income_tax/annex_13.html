<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Annex-13(Ka) - Income Tax Form</title>
    <link rel="stylesheet" href="../../extjs/resources/ext-all.css">
    <link rel="stylesheet" href="../../css/all.css">
    <link rel="stylesheet" href="../../css/taxpayer_portal.css">
    <link rel="stylesheet" href="../../css/income_tax/d01_return_entry.css">
    <style>
        body { margin: 0; padding: 0; background: #DFE9F6; font-family: Arial, sans-serif; }
        .annex13-page { width: 100%; max-width: 100%; background: #DFE9F6; }
        .x-panel-header { background: linear-gradient(#B7D3F3, #8DB3E3); padding: 10px; font-weight: bold; }
        .section-header { background: #DCE6F1; padding: 10px; font-weight: bold; border: 1px solid #C5D9F1; }
        .x-btn { background: linear-gradient(#FEFEFE, #E6E6E6); border: 1px solid #B5B8C8; padding: 5px 10px; cursor: pointer; margin: 5px; }
        .x-btn:hover { background: linear-gradient(#F5F5F5, #D5D5D5); }
        table { width: 100%; border-collapse: collapse; }
        td { border: 1px solid #C5D9F1; padding: 8px; }
        input[type="text"] { border: 1px solid #B5B8C8; padding: 4px; width: 95%; }
        .TxtRight { text-align: right; }
    </style>
</head>
<body>
    <div class="annex13-page">
        <div style="margin: 5px; background: white; border: 1px solid #C5D9F1;">
            <!-- Header -->
            <div style="background: linear-gradient(#B7D3F3, #8DB3E3); padding: 10px; color: white; font-weight: bold; display: flex; justify-content: space-between; align-items: center;">
                <span>Annex-13(Ka)</span>
                <button class="x-btn" onclick="window.print();" style="margin: 0;">
                    <span>üñ® Print</span>
                </button>
            </div>

            <!-- Form Content -->
            <div style="padding: 15px;">
                <!-- Title -->
                <div style="text-align: center; font-size: 18px; font-weight: bold; margin: 15px 0;">
                    ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä - ‡•ß‡•© (‡§ï)
                </div>

                <!-- Back Link Panel -->
                <div style="background: #E8F4FF; border: 1px solid #5B9BD5; padding: 10px; margin: 10px 0; border-radius: 4px;">
                    <span style="color: #003366;">‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® </span>
                    <span id="lnkRedirectD02" style="cursor: pointer; color: red; text-decoration: underline; font-weight: bold;">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span>
                    <span style="color: #003366;"> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
                </div>

                <!-- Submission Details Panel -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr>
                            <td style="width: 30%;">‡§∏‡§¨‡•ç‡§Æ‡§ø‡§∂‡§® ‡§®‡§Ç.:</td>
                            <td><input type="text" id="submissionNo" readonly /></td>
                            <td style="width: 30%;">‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</td>
                            <td><input type="text" id="fiscalYear" readonly /></td>
                        </tr>
                        <tr>
                            <td>‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞:</td>
                            <td colspan="3"><input type="text" id="panNo" readonly style="width: 100%;" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Financial Description Panel -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§µ‡§ø‡§§‡•ç‡§§‡§ø‡§Ø ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∏‡•ç‡§ü ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</div>
                    <table>
                        <thead>
                            <tr style="background: #DCE6F1;">
                                <th style="width: 50%; text-align: left;">‡§∏‡•Å‡§ö‡•Ä</th>
                                <th style="width: 50%; text-align: left;">‡§∞‡§ï‡§Æ ‡§µ‡§æ ‡§™‡•ç‡§∞‡§§‡§ø‡§∂‡§§</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br><span style="font-size: 12px; color: #666;">Sales This Year</span></td>
                                <td><input type="text" id="txtFinDesc0" class="TxtRight" /></td>
                            </tr>
                            <tr>
                                <td>‡§∏‡•á‡§µ‡§æ ‡§∞ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞<br><span style="font-size: 12px; color: #666;">Services and Sales of Business</span></td>
                                <td><input type="text" id="txtFinDesc1" class="TxtRight" /></td>
                            </tr>
                            <tr>
                                <td>‡§ï‡§∞ ‡§Ö‡§ò‡§ø‡§ï‡•ã ‡§ñ‡•Å‡§¶ ‡§Ü‡§Ø/‡§®‡•ã‡§ï‡•ç‡§∏‡§æ‡§®‡•Ä ‡§Ø‡§∏ ‡§Ü.‡§µ.<br><span style="font-size: 12px; color: #666;">Net Profit / Loss Before Tax This Year</span></td>
                                <td><input type="text" id="txtFinDesc2" class="TxtRight" /></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Save Button -->
                <div style="margin: 15px 0;">
                    <button class="x-btn" onclick="saveAnnex13();">
                        üíæ Save
                    </button>
                </div>

                <!-- Less than 100,000 Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∞‡•Å ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¨‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr>
                            <td>‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§ï‡§Æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø ‡§è‡§ï‡§Æ‡•Å‡§∑‡•ç‡§† ‡§∞‡§ï‡§Æ</td>
                            <td><input type="text" id="lessThan100k" class="TxtRight" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Greater than 100,000 Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∞‡•Å ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£</div>
                    <table>
                        <tr style="background: #EFF5FB;">
                            <td colspan="2">
                                <input type="checkbox" id="chkTransaction" /> ‡§ï‡•Å‡§®‡•à ‡§™‡§®‡§ø ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø / ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ ‡§∏‡§Ç‡§ó ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑ ‡§≠‡§∞‡§ø‡§Æ‡§æ ‡§∞‡•Ç ‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä‡§ï‡•ã ‡§ï‡§æ‡§∞‡•ã‡§¨‡§æ‡§∞ ‡§õ‡•à‡§®
                            </td>
                        </tr>
                    </table>
                </div>

                <!-- Load From Excel Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0; padding: 10px;">
                    <div class="section-header">‡§è‡§ï‡•ç‡§∏‡•á‡§≤ ‡§´‡§æ‡§á‡§≤‡§¨‡§æ‡§ü ‡§≤‡•ã‡§° ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç</div>
                    <div style="padding: 10px;">
                        <label>‡§≤‡•ã‡§° XLS: </label>
                        <input type="file" id="excelFile" accept=".xls,.xlsx" />
                        <button class="x-btn" onclick="alert('Upload functionality coming soon');">‚¨Ü Upload</button>
                        <button class="x-btn" onclick="alert('Sample view coming soon');">üìã View Sample</button>
                    </div>
                </div>

                <!-- Transaction Grid Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§∂‡•Å‡§∞‡•Å ‡§Æ‡•å‡§ú‡•ç‡§¶‡§æ‡§§, ‡§ñ‡§∞‡§ø‡§¶, ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ (‡§è‡§ï ‡§≤‡§æ‡§ñ ‡§≠‡§®‡•ç‡§¶‡§æ ‡§¨‡§¢‡•Ä)</div>
                    <div style="overflow-x: auto; margin: 10px 0;">
                        <table style="min-width: 100%; font-size: 12px;">
                            <thead>
                                <tr style="background: #DCE6F1;">
                                    <th style="width: 5%;">‡§ï‡•ç‡§∞.</th>
                                    <th style="width: 15%;">‡§∏‡•ç‡§•‡§æ‡§Ø‡•Ä ‡§≤‡•á‡§ñ‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞</th>
                                    <th style="width: 25%;">‡§µ‡•ç‡§Ø‡§µ‡§∏‡§æ‡§Ø‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                                    <th style="width: 15%;">‡§∂‡•Å‡§∞‡•Å ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§∞‡§ï‡§Æ)</th>
                                    <th style="width: 15%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§ñ‡§∞‡§ø‡§¶</th>
                                    <th style="width: 15%;">‡§Ø‡•ã ‡§µ‡§∞‡•ç‡§∑ ‡§¨‡§ø‡§ï‡•ç‡§∞‡§ø</th>
                                    <th style="width: 15%;">‡§Ö‡§®‡•ç‡§§ ‡§≤‡§ø‡§® ‡§¨‡§æ‡§ï‡•Ä (‡§∞‡§ï‡§Æ)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>‡•ß</td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                </tr>
                                <tr>
                                    <td>‡•®</td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                    <td><input type="text" class="TxtRight" style="width: 95%;" /></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <button class="x-btn" onclick="addTransactionRow();">‚ûï Add New</button>
                    <button class="x-btn" onclick="deleteAllRows();">‚ùå Delete All</button>
                    <button class="x-btn" onclick="checkSum();">üßÆ Check Sum</button>
                </div>

                <!-- Totals Section -->
                <div style="border: 1px solid #C5D9F1; margin: 10px 0;">
                    <div class="section-header">‡§ú‡§Æ‡•ç‡§Æ‡§æ</div>
                    <table>
                        <tr>
                            <td style="width: 30%;">‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§∞‡§ï‡§Æ:</td>
                            <td><input type="text" id="totalSales" readonly class="TxtRight" /></td>
                            <td style="width: 30%;">‡§ú‡§Æ‡•ç‡§Æ‡§æ ‡§ñ‡§∞‡§ø‡§¶ ‡§∞‡§ï‡§Æ:</td>
                            <td><input type="text" id="totalPurchase" readonly class="TxtRight" /></td>
                        </tr>
                    </table>
                </div>

                <!-- Save Transaction Button -->
                <div style="margin: 15px 0;">
                    <button class="x-btn" onclick="saveTransaction();">
                        üíæ Save Transaction
                    </button>
                </div>

                <!-- Back Link at Bottom -->
                <div style="background: #E8F4FF; border: 1px solid #5B9BD5; padding: 10px; margin: 10px 0; border-radius: 4px; text-align: center;">
                    <span style="color: #003366;">‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§® </span>
                    <span id="lnkRedirectD02Bottom" style="cursor: pointer; color: red; text-decoration: underline; font-weight: bold;">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span>
                    <span style="color: #003366;"> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global loadInParentIframe function for consistency
        window.loadInParentIframe = function(url) {
            try {
                if (parent && parent.loadInParentIframe && parent !== window) {
                    parent.loadInParentIframe(url);
                } else {
                    window.open(url, '_blank');
                }
            } catch (e) {
                console.error('Error in loadInParentIframe:', e);
                window.open(url, '_blank');
            }
        };

        // Handle back links to D-02
        document.getElementById('lnkRedirectD02').addEventListener('click', function(e) {
            e.preventDefault();
            loadInParentIframe('income_tax/d02_main_form.html');
        });
        
        document.getElementById('lnkRedirectD02Bottom').addEventListener('click', function(e) {
            e.preventDefault();
            loadInParentIframe('income_tax/d02_main_form.html');
        });

        // Form functions
        function saveAnnex13() {
            alert('Financial description saved (demo)');
        }

        function addTransactionRow() {
            alert('Add new transaction row (demo)');
        }

        function deleteAllRows() {
            if (confirm('Delete all transaction rows?')) {
                alert('All rows deleted (demo)');
            }
        }

        function checkSum() {
            alert('Check Sum calculation (demo)');
        }

        function saveTransaction() {
            alert('Transaction saved (demo)');
        }

        // Load data from D-02 if available
        window.onload = function() {
            const d02Data = JSON.parse(sessionStorage.getItem('d02_current_registration') || '{}');
            if (d02Data.submissionNo) {
                document.getElementById('submissionNo').value = d02Data.submissionNo;
            }
            if (d02Data.fiscalYear) {
                document.getElementById('fiscalYear').value = d02Data.fiscalYear;
            }
            if (d02Data.pan) {
                document.getElementById('panNo').value = d02Data.pan;
            }
        };
    </script>
</body>
</html>
