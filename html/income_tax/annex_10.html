<!DOCTYPE html>
<html lang="ne">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annex-10 - ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä -‡•ß‡•¶</title>
    <link rel="stylesheet" href="../../extjs/resources/ext-all.css">
    <link rel="stylesheet" href="../../css/all.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        html, body {
            height: 100%;
            overflow: auto;
        }

        body {
            background-color: #DFE9F6;
            margin: 0;
            padding: 18px;
            font-family: Arial, sans-serif;
            font-size: 11px;
            -webkit-overflow-scrolling: touch;
        }
        
        .annex-container {
            background: #DFE9F6;
            border: 1px solid #C5D9F1;
            border-radius: 5px;
            padding: 12px;
            max-width: 1400px;
            margin: 0 auto;
            box-sizing: border-box;
            /* allow the container to scroll when iframe is small - give it more vertical room */
            max-height: calc(100vh - 8px);
            overflow: auto;
        }
        
        .annex-header {
            background: linear-gradient(#E8F1FA, #D0E4F7);
            padding: 8px 12px;
            margin-bottom: 10px;
            border: 1px solid #99BCE8;
            border-radius: 3px;
            font-weight: bold;
            color: #003366;
        }
        
        .section-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin: 6px 0;
        }
        
        .print-btn {
            background: linear-gradient(#FEFEFE, #E6E6E6);
            border: 1px solid #B5B8C8;
            padding: 6px 14px;
            cursor: pointer;
            margin-bottom: 8px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            border-radius: 3px;
        }
        
        .print-btn:hover {
            background: linear-gradient(#F5F5F5, #D5D5D5);
        }
        
        .info-box {
            background: #E8F4FF;
            border: 1px solid #99BCE8;
            padding: 8px 10px;
            margin: 8px 0;
            border-radius: 3px;
        }
        
        .info-box.warning {
            background: #FFF9E6;
            border-color: #FFD700;
        }
        
        .info-box.note {
            background: #F0F8FF;
        }
        
        .red-text {
            color: red;
            font-weight: bold;
        }
        
        .blue-text {
            color: #003366;
            font-weight: bold;
        }
        
        .load-voucher-btn {
            background: #F5F5F5;
            border: 1px solid #B5B8C8;
            padding: 8px 16px;
            cursor: pointer;
            margin: 10px 0;
            border-radius: 3px;
        }
        
        .load-voucher-btn:hover {
            background: #E8E8E8;
        }
        
        table.tax-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        table.tax-table th,
        table.tax-table td {
            border: 1px solid #C5D9F1;
            padding: 4px 6px;
            text-align: center;
            font-size: 11px;
        }
        
        table.tax-table th {
            background: linear-gradient(#E8F1FA, #D0E4F7);
            font-weight: bold;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 8px 0;
        }

        /* Improve checkbox visibility inside iframes */
        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            accent-color: #1F548A;
            vertical-align: middle;
        }

        .checkbox-label label {
            font-size: 13px;
            color: #003366;
        }
        
        select.dropdown {
            padding: 6px;
            border: 1px solid #B5B8C8;
            border-radius: 3px;
            min-width: 200px;
        }

        /* Action buttons container: hidden by default, left-aligned when shown */
        #actionButtonsContainer {
            margin: 8px 0;
            display: none; /* toggled to flex by JS when checkbox checked */
            justify-content: flex-start;
            gap: 8px;
            align-items: center;
        }

        /* Disclaimer Banner */
        .disclaimer-banner {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 15px 20px;
            margin: 10px;
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
            text-align: left;
        }

        @media screen and (max-width: 768px) {
            .disclaimer-banner {
                font-size: 12px;
                padding: 12px 15px;
            }
        }

        @media screen and (max-width: 480px) {
            .disclaimer-banner {
                font-size: 11px;
                padding: 10px 12px;
            }
        }
    </style>
</head>
<body>
    <!-- Disclaimer Banner -->
    <div class="disclaimer-banner">
        <strong>‚ö†Ô∏è IMPORTANT NOTICE:</strong> This website is provided strictly for training and demonstration purposes only. 
        It is NOT connected to the official Inland Revenue Department (IRD) of Nepal. 
        Do not enter any real, sensitive, or confidential taxpayer information. 
        Any data entered here will not be processed or submitted to the actual IRD system. 
        For official tax filing, please visit the authentic IRD portal.
    </div>

    <div class="annex-container">
        <div class="annex-header">
            Annex-10
        </div>
        
        <button class="print-btn" onclick="window.print()">
            <span>üñ®</span>
            <span>Print</span>
        </button>
        
        <div class="section-title">‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä -‡•ß‡•¶</div>
        
        <div class="info-box">
            <span>‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§®‡•Å </span>
            <span class="red-text">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span>
            <span> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§</span>
        </div>
        
        <div style="margin: 15px 0;">
            <label style="margin-right: 10px;">‡§ï‡§∞ ‡§¶‡§æ‡§Ø‡•Ä‡§ï‡•ã ‡§ï‡§ø‡§∏‡§ø‡§Æ :</label>
            <select class="dropdown" id="taxPayerType" onchange="showTransferFields()">
                <option value="">Select ...</option>
                <option value="transfer_of_credit">Transfer Of Credit</option>
            </select>
        </div>
        
        <!-- Transfer of Credit Fields (Hidden by default) -->
        <div id="transferFields" style="display: none; margin: 6px 0; padding: 8px; background: #E8F4FF; border: 1px solid #99BCE8; border-radius: 5px;">
            <div style="margin-bottom: 15px;">
                <label style="display: inline-block; width: 200px; text-align: right; margin-right: 10px; font-weight: normal;">‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</label>
                <input type="text" id="fiscalYear" value="2081.082" readonly style="padding: 8px; border: 1px solid #B5B8C8; border-radius: 3px; width: 150px; background-color: #F0F0F0;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: inline-block; width: 200px; text-align: right; margin-right: 10px; font-weight: normal;">‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§∏‡§æ‡§∞‡•á‡§ï‡•ã ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑:</label>
                <input type="text" id="creditTransferYear" style="padding: 8px; border: 1px solid #B5B8C8; border-radius: 3px; width: 150px;">
            </div>
            
            <div style="margin-bottom: 15px;">
                <label style="display: inline-block; width: 200px; text-align: right; margin-right: 10px; font-weight: normal;">‡§¶‡§æ‡§ñ‡•Ä‡§≤‡§æ ‡§∞‡§ï‡§Æ :</label>
                <input type="text" id="submissionAmount" style="padding: 8px; border: 1px solid #B5B8C8; border-radius: 3px; width: 200px;">
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button onclick="addTransferRecord()" style="background: linear-gradient(#FEFEFE, #E6E6E6); border: 1px solid #B5B8C8; padding: 8px 20px; cursor: pointer; border-radius: 4px; display: inline-flex; align-items: center; gap: 8px;">
                    <span style="color: green; font-size: 18px; font-weight: bold;">+</span>
                    <span>Add</span>
                </button>
            </div>
        </div>
        
        <div class="info-box blue-text">
            ‡§∏‡•å ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§¨‡§∞‡•ç‡§∑‡§ï‡•ã ‡§ï‡§∞ ‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§∞ TDS ‡§∞‡§ï‡§Æ ‡§∏‡§Æ‡§æ‡§¨‡•á‡§∂ ‡§ó‡§∞‡•ç‡§®‡•Å ‡§§‡§≤ ‡§≤‡•á‡§ñ‡§ø‡§è‡§ï‡•ã Load Payment Vouchers and TDS Amount ‡§¨‡§ü‡§® ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§
        </div>
        
        <div style="margin: 20px 0;">
            <button class="load-voucher-btn" onclick="openTaxpayerLoginModal()">Load Payment Vouchers and TDS Amount</button>
        </div>
        
        <div class="annex-header" style="margin-top: 25px;">
            ‡§ï‡§∞ ‡§≠‡•Å‡§ï‡•ç‡§§‡§æ‡§® ‡§¶‡§æ‡§µ‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£
        </div>
        
        <div style="overflow-x: auto; overflow-y: auto; max-height: 400px; border: 1px solid #C5D9F1;">
            <table class="tax-table">
                <thead>
                    <tr>
                        <th>‡§ï‡•ç‡§∞.‡§∏.</th>
                        <th>‡•ß</th>
                        <th>‡•®</th>
                        <th>‡•©</th>
                        <th>‡•™</th>
                        <th>‡•´</th>
                        <th>‡•¨</th>
                        <th>‡•≠</th>
                        <th>‡•Æ</th>
                        <th>‡•Ø</th>
                        <th>‡•ß‡•¶</th>
                        <th>‡•ß‡•ß</th>
                        <th>‡•ß‡•®</th>
                    </tr>
                    <tr>
                        <th style="min-width: 60px;"></th>
                        <th style="min-width: 100px;">‡§ï‡§∞ ‡§¶‡§æ‡§Ø‡•Ä‡§ï‡•ã ‡§ï‡§ø‡§∏‡§ø‡§Æ</th>
                        <th style="min-width: 120px;">‡§∞‡§æ‡§ú‡§∏‡•ç‡§µ ‡§∂‡§ø‡§∞‡•ç‡§∑‡§ï</th>
                        <th style="min-width: 150px;">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ‡§ï‡•ã ‡§§‡§æ‡§∞‡§ø‡§ñ</th>
                        <th style="min-width: 150px;">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§®‡§Ç‡§∏‡•ç‡§Ø‡§æ ‡§®‡§Æ‡•ç‡§¨‡§∞</th>
                        <th style="min-width: 150px;">‡§¨‡•à‡§Ç‡§ï‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                        <th style="min-width: 120px;">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§Æ‡§ø‡§§‡§ø</th>
                        <th style="min-width: 120px;">‡§ï‡§æ‡§∞‡•ç‡§Ø‡§æ‡§≤‡§Ø</th>
                        <th style="min-width: 250px;">‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§ï‡§∞ ‡§ï‡§ü‡•ç‡§ü‡•Ä‡§ï‡•ã ‡§ï‡§ø‡§∏‡§ø‡§Æ / ‡§Ö‡§ó‡•ç‡§∞‡§ø‡§Æ ‡§ï‡§∞ ‡§ï‡§ü‡•ç‡§ü‡•Ä ‡§ó‡§∞‡•ç‡§®‡•á‡§ï‡•ã ‡§®‡§æ‡§Æ</th>
                        <th style="min-width: 150px;">‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§∞‡§ï‡§Æ</th>
                        <th style="min-width: 180px;">‡§π‡§ø‡§∏‡§æ‡§¨ ‡§Æ‡§ø‡§§‡§®‡§ï‡•ã ‡§ï‡§æ‡§∞‡§£</th>
                        <th style="min-width: 120px;">‡§≤‡§ø‡§ñ‡§§ ‡§®‡§Æ‡•ç‡§¨‡§∞</th>
                        <th style="min-width: 100px;">LCG Status</th>
                    </tr>
                </thead>
                <tbody id="taxPaymentTableBody">
                    <tr>
                        <td colspan="13" style="padding: 12px; text-align: center; color: #999;">
                            No data available
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr style="background: #E8F4FF; font-weight: bold;">
                        <td colspan="9" style="text-align: right; padding: 6px;">Total Credit</td>
                        <td style="text-align: right; padding: 6px;">0.00</td>
                        <td colspan="3"></td>
                    </tr>
                </tfoot>
            </table>
        </div>
        
        <div class="info-box warning">
            **‡§Æ‡§æ‡§•‡§ø‡§ï‡•ã ‡§≠‡•Å‡§ï‡•ç‡§§‡§æ‡§®‡§ø ‡§µ‡§ø‡§µ‡§∞‡§£‡§Æ‡§æ ‡§¶‡§æ‡§µ‡•Ä ‡§ó‡§∞‡•ç‡§®‡•Å ‡§®‡§™‡§∞‡•ç‡§®‡•á ‡§≠‡•Å‡§ï‡•ç‡§§‡§æ‡§®‡§ø ‡§π‡§ü‡§æ‡§â‡§®‡§ï‡•ã ‡§≤‡§æ‡§ó‡•Ä ‡§õ‡•á‡§°‡•à‡§ï‡•ã ‡§°‡§ø‡§≤‡§ø‡§ü ‡§¨‡§ü‡§®‡§Æ‡§æ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§≤‡§æ ‡•§
        </div>
        
        <div class="checkbox-label">
            <input type="checkbox" id="showAllPayments">
            <label for="showAllPayments">
                <strong>‡§Ø‡§∏ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡§ø‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§¨‡•á‡§∏ ‡§≠‡§è‡§ï‡§æ ‡§ï‡§∞ ‡§¶‡§æ‡§ñ‡§ø‡§≤‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§π‡§ø ‡§∏‡§æ‡§Ç‡§ö‡•ã ‡§≠‡§è‡§ï‡•ã ‡§ò‡•ã‡§∑‡§£‡§æ ‡§ó‡§∞‡•ç‡§¶‡§õ‡•Å ‡•§</strong>
            </label>
        </div>
        
        <div style="margin: 10px 0; font-size: 13px;">
            **Check Box Select ‡§≠‡§è ‡§™‡§õ‡§ø ‡§Æ‡§æ‡§§‡•ç‡§∞ Save ‡§µ‡§æ Update ‡§¨‡§ü‡§® ‡§¶‡•á‡§ñ‡§ø‡§®‡•á ‡§õ ‡•§ ‡•§
        </div>
        
        <!-- Save/Update Buttons - Hidden by default -->
        <div id="actionButtonsContainer">
            <button class="x-btn" onclick="saveAnnex10Data()" style="margin: 0 8px 0 0; padding: 8px 20px; background: linear-gradient(#FEFEFE, #E6E6E6); border: 1px solid #B5B8C8; cursor: pointer; border-radius: 4px;">
                <span>Save</span>
            </button>
            <button class="x-btn" onclick="updateAnnex10Data()" style="margin: 0 8px 0 0; padding: 8px 20px; background: linear-gradient(#FEFEFE, #E6E6E6); border: 1px solid #B5B8C8; cursor: pointer; border-radius: 4px;">
                <span>Update</span>
            </button>
        </div>
        
        <div class="info-box note">
            ‡§™‡§õ‡§æ‡§°‡§ø ‡§ó‡§è‡§∞ ‡§Ö‡§®‡•Å‡§∏‡•Ç‡§ö‡•Ä ‡§§‡§Ø ‡§ó‡§∞‡•ç‡§®‡•Å <span class="red-text">‡§Ø‡§π‡§æ‡§Å ‡§ï‡•ç‡§≤‡§ø‡§ï</span> ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç ‡•§
        </div>
    </div>
    
    <!-- Taxpayer Login Modal -->
    <div id="taxpayerLoginModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.4);">
        <div style="background-color: #E8F4FF; margin: 8% auto; padding: 0; border: 2px solid #5B9BD5; width: 50%; max-width: 600px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3);">
            <!-- Modal Header -->
            <div style="background: linear-gradient(#B7D3F3, #8DB3E3); padding: 12px 15px; border-bottom: 2px solid #5B9BD5; display: flex; justify-content: space-between; align-items: center; border-radius: 6px 6px 0 0;">
                <h3 style="margin: 0; color: #003366; font-size: 18px; font-weight: bold;">Taxpayer Login</h3>
                <span onclick="closeTaxpayerLoginModal()" style="cursor: pointer; font-size: 24px; font-weight: bold; color: #666;">&times;</span>
            </div>
            
            <!-- Modal Body -->
            <div style="padding: 30px 40px; background-color: #E8F4FF;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">Pan:</label>
                    <input type="text" id="loginPan" maxlength="9" value="" readonly style="width: 100%; padding: 10px; border: 1px solid #B5B8C8; border-radius: 4px; box-sizing: border-box; background-color: #F0F0F0; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">User Name:</label>
                    <input type="text" id="loginUsername" style="width: 100%; padding: 10px; border: 1px solid #B5B8C8; border-radius: 4px; box-sizing: border-box; font-size: 14px;">
                </div>
                
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px;">Password:</label>
                    <input type="password" id="loginPassword" style="width: 100%; padding: 10px; border: 1px solid #B5B8C8; border-radius: 4px; box-sizing: border-box; font-size: 14px;">
                </div>
                
                <div style="text-align: center;">
                    <button onclick="handleTaxpayerLogin()" style="background: linear-gradient(#FEFEFE, #E6E6E6); border: 1px solid #B5B8C8; padding: 8px 30px; cursor: pointer; border-radius: 4px; font-size: 14px; font-weight: bold;">
                        Login
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Load PAN number from sessionStorage on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedPan = sessionStorage.getItem('d02_panNo');
            if (savedPan) {
                document.getElementById('loginPan').value = savedPan;
            }
        });
        
        // Show/Hide Transfer of Credit fields
        function showTransferFields() {
            const selectedValue = document.getElementById('taxPayerType').value;
            const transferFields = document.getElementById('transferFields');
            
            if (selectedValue === 'transfer_of_credit') {
                transferFields.style.display = 'block';
            } else {
                transferFields.style.display = 'none';
            }
        }
        
        // Add Transfer Record
        function addTransferRecord() {
            const creditTransferYear = document.getElementById('creditTransferYear').value;
            const submissionAmount = document.getElementById('submissionAmount').value;
            
            if (!creditTransferYear || !submissionAmount) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§∏‡§¨‡•à ‡§´‡§ø‡§≤‡•ç‡§° ‡§≠‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç! (Please fill all fields!)');
                return;
            }
            
            alert('‡§∞‡•á‡§ï‡§∞‡•ç‡§° ‡§•‡§™‡§ø‡§Ø‡•ã! (Record Added!)\n‡§ï‡•ç‡§∞‡•á‡§°‡§ø‡§ü ‡§∏‡§æ‡§∞‡•á‡§ï‡•ã ‡§Ü‡§∞‡•ç‡§•‡§ø‡§ï ‡§µ‡§∞‡•ç‡§∑: ' + creditTransferYear + '\n‡§¶‡§æ‡§ñ‡•Ä‡§≤‡§æ ‡§∞‡§ï‡§Æ: ' + submissionAmount);
            
            // Clear fields after adding
            document.getElementById('creditTransferYear').value = '';
            document.getElementById('submissionAmount').value = '';
        }
        
        // Open Taxpayer Login Modal
        function openTaxpayerLoginModal() {
            // Get PAN number from sessionStorage
            const savedPan = sessionStorage.getItem('d02_panNo');
            if (savedPan) {
                document.getElementById('loginPan').value = savedPan;
            }
            document.getElementById('taxpayerLoginModal').style.display = 'block';
        }
        
        // Close Taxpayer Login Modal
        function closeTaxpayerLoginModal() {
            document.getElementById('taxpayerLoginModal').style.display = 'none';
        }
        
        // Handle Taxpayer Login
        function handleTaxpayerLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;

            if (!username || !password) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ User Name ‡§∞ Password ‡§≠‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç! (Please enter User Name and Password!)');
                return;
            }

            // Close modal and load data silently (no native alert)
            closeTaxpayerLoginModal();
            loadDemoTDSData();
        }
        
        // Load demo TDS data
        function loadDemoTDSData() {
            const tableBody = document.getElementById('taxPaymentTableBody');
            
            // Demo TDS data
            const tdsData = [
                {
                    type: 'TDS',
                    revenueHead: '11132',
                    dateSubmitted: '',
                    voucherNo: '810065432724',
                    bankName: '',
                    submissionDate: '2081.06.30',
                    office: '11132',
                    advanceTaxType: '‡§è‡§Ø‡§∞‡§≠‡§¨‡§ø ‡§¨‡•à‡§Ç‡§ï ‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§°',
                    amount: '17.94',
                    accountReason: '',
                    documentNo: '500106495',
                    lcgStatus: 'delete'
                },
                {
                    type: 'TDS',
                    revenueHead: '11132',
                    dateSubmitted: '',
                    voucherNo: '810068028751',
                    bankName: '',
                    submissionDate: '2081.09.29',
                    office: '11132',
                    advanceTaxType: '‡§è‡§Ø‡§∞‡§≠‡§¨‡§ø ‡§¨‡•à‡§Ç‡§ï ‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§°',
                    amount: '0.42',
                    accountReason: '',
                    documentNo: '500106495',
                    lcgStatus: 'delete'
                },
                {
                    type: 'TDS',
                    revenueHead: '11132',
                    dateSubmitted: '',
                    voucherNo: '820070194194',
                    bankName: '',
                    submissionDate: '2081.12.31',
                    office: '11132',
                    advanceTaxType: '‡§è‡§Ø‡§∞‡§≠‡§¨‡§ø ‡§¨‡•à‡§Ç‡§ï ‡§≤‡§ø‡§Æ‡§ø‡§ü‡•á‡§°',
                    amount: '78.59',
                    accountReason: '',
                    documentNo: '500106495',
                    lcgStatus: 'delete'
                }
            ];
            
            // Calculate total
            let totalCredit = 0;
            tdsData.forEach(item => {
                totalCredit += parseFloat(item.amount);
            });
            
            // Build table rows
            let rows = '';
            tdsData.forEach((item, index) => {
                rows += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.type}</td>
                        <td>${item.revenueHead}</td>
                        <td>${item.dateSubmitted}</td>
                        <td>${item.voucherNo}</td>
                        <td>${item.bankName}</td>
                        <td>${item.submissionDate}</td>
                        <td>${item.office}</td>
                        <td>${item.advanceTaxType}</td>
                        <td style="text-align: right;">${item.amount}</td>
                        <td>${item.accountReason}</td>
                        <td>${item.documentNo}</td>
                        <td style="text-align: center;">
                            <button onclick="deleteTDSRow(${index + 1})" style="background: none; border: none; cursor: pointer; padding: 0;">
                                <span style="color: red; font-size: 20px; font-weight: bold;">‚äñ</span>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            // Update table
            tableBody.innerHTML = rows;
            
            // Update total
            document.querySelector('tfoot td[style*="text-align: right"]').textContent = totalCredit.toFixed(2);
        }
        
        // Delete TDS row
        function deleteTDSRow(rowIndex) {
            if (confirm('‡§ï‡•á ‡§§‡§™‡§æ‡§à‡§Ç ‡§Ø‡•ã ‡§∞‡•á‡§ï‡§∞‡•ç‡§° ‡§π‡§ü‡§æ‡§â‡§® ‡§ö‡§æ‡§π‡§®‡•Å‡§π‡•Å‡§®‡•ç‡§õ? (Do you want to delete this record?)')) {
                const tableBody = document.getElementById('taxPaymentTableBody');
                tableBody.deleteRow(rowIndex - 1);
                
                // Recalculate total
                let total = 0;
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    const amountCell = row.cells[9];
                    if (amountCell) {
                        const amount = parseFloat(amountCell.textContent) || 0;
                        total += amount;
                    }
                });
                
                // Update total
                document.querySelector('tfoot td[style*="text-align: right"]').textContent = total.toFixed(2);
                
                // If no rows left, show "No data available"
                if (rows.length === 0) {
                    tableBody.innerHTML = '<tr><td colspan="13" style="padding: 30px; text-align: center; color: #999;">No data available</td></tr>';
                }
            }
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('taxpayerLoginModal');
            if (event.target == modal) {
                closeTaxpayerLoginModal();
            }
        }
    </script>

    <script>
        // Adjust parent iframe height (works when same-origin)
        function adjustIframeHeight() {
            try {
                const doc = document.documentElement;
                const body = document.body;
                // total height of content
                const height = Math.max(
                    body.scrollHeight, body.offsetHeight,
                    doc.clientHeight, doc.scrollHeight, doc.offsetHeight
                );

                if (window.frameElement && window.frameElement.tagName === 'IFRAME') {
                    window.frameElement.style.height = (height + 20) + 'px';
                }
            } catch (e) {
                // silent fail if cross-origin
                console.warn('Could not adjust iframe height:', e);
            }
        }

        // Run on load and when content changes
        window.addEventListener('load', adjustIframeHeight);
        window.addEventListener('resize', adjustIframeHeight);

        // Observe DOM changes and adjust
        const observer = new MutationObserver(function() {
            adjustIframeHeight();
        });
        observer.observe(document.body, { childList: true, subtree: true, attributes: true });

        // Call adjust when interactive actions may change layout
        function showTransferFields() {
            const selectedValue = document.getElementById('taxPayerType').value;
            const transferFields = document.getElementById('transferFields');
            if (selectedValue === 'transfer_of_credit') {
                transferFields.style.display = 'block';
            } else {
                transferFields.style.display = 'none';
            }
            adjustIframeHeight();
        }

        // Ensure action buttons toggle adjusts iframe
        document.addEventListener('DOMContentLoaded', function() {
            const cb = document.getElementById('showAllPayments');
            if (cb) {
                cb.addEventListener('change', function() {
                    adjustIframeHeight();
                });
            }
        });

        // When demo data loads, adjust
        function loadDemoTDSDataWrapper() {
            if (typeof loadDemoTDSData === 'function') loadDemoTDSData();
            adjustIframeHeight();
        }
        // Replace the handler used by login to call wrapper if needed
        const origHandle = window.handleTaxpayerLogin;
        window.handleTaxpayerLogin = function() {
            if (typeof origHandle === 'function') origHandle();
            // Delay to allow DOM updates
            setTimeout(adjustIframeHeight, 250);
        };
    </script>
    
    <script>
        // Enable save/update buttons when checkbox is checked
        $('#showAllPayments').on('change', function() {
            const actionButtons = document.getElementById('actionButtonsContainer');
            if ($(this).is(':checked')) {
                // Show Save/Update buttons (use flex to left-align)
                actionButtons.style.display = 'flex';
                console.log('Checkbox checked - Save/Update buttons visible');
            } else {
                // Hide Save/Update buttons
                actionButtons.style.display = 'none';
                console.log('Checkbox unchecked - Save/Update buttons hidden');
            }
            // Adjust iframe height when buttons container toggles
            try { adjustIframeHeight(); } catch(e) { /* ignore */ }
        });
        
        // Save Annex-10 data
        function saveAnnex10Data() {
            if (!document.getElementById('showAllPayments').checked) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§ø‡§≤‡•á checkbox select ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç! (Please check the checkbox first!)');
                return;
            }
            
            alert('Annex-10 ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§∏‡•á‡§≠ ‡§ó‡§∞‡§ø‡§Ø‡•ã! (Annex-10 data saved successfully!)');
            // You can add actual save logic here
        }
        
        // Update Annex-10 data
        function updateAnnex10Data() {
            if (!document.getElementById('showAllPayments').checked) {
                alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§ø‡§≤‡•á checkbox select ‡§ó‡§∞‡•ç‡§®‡•Å‡§π‡•ã‡§∏‡•ç! (Please check the checkbox first!)');
                return;
            }
            
            alert('Annex-10 ‡§°‡•á‡§ü‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§Ö‡§™‡§°‡•á‡§ü ‡§ó‡§∞‡§ø‡§Ø‡•ã! (Annex-10 data updated successfully!)');
            // You can add actual update logic here
        }
    </script>
</body>
</html>
